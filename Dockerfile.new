# Stage 1: Build React Frontend
# BUILD_CACHE_BUSTER forces cache invalidation
FROM node:20-alpine AS frontend-build
ARG BUILD_CACHE_BUSTER=2025-12-16-v4
WORKDIR /app/react

# Copy package files and install dependencies
COPY react/package*.json ./
RUN npm ci --legacy-peer-deps

# Copy React source code
COPY react/ .

# Build the React app (output goes to react/dist)
RUN npm run build

# Stage 2: Python Backend
FROM python:3.12-slim
WORKDIR /app

# Install system dependencies